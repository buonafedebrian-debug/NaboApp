mkdir fastlane
@'
source "https://rubygems.org"
gem "fastlane"
'@ | Set-Content -Encoding utf8 Gemfile

@'
default_platform(:ios)
platform :ios do
  lane :ci do
    increment_build_number(xcodeproj: "ios/App/App.xcodeproj")
    gym(
      workspace: "ios/App/App.xcworkspace",
      scheme: "App",
      configuration: "Release",
      export_method: "app-store",
      output_directory: "build",
      clean: true,
      xcargs: "PRODUCT_BUNDLE_IDENTIFIER=com.nabo.marketplace DEVELOPMENT_TEAM=#{ENV['APPLE_TEAM_ID']} CODE_SIGN_STYLE=Automatic CODE_SIGNING_ALLOWED=YES CODE_SIGNING_REQUIRED=YES",
      export_options: { signingStyle: "automatic" }
    )
    pilot(
      app_identifier: ENV['APP_IDENTIFIER'],
      skip_waiting_for_build_processing: true,
      distribute_external: false,
      verbose: true
    )
  end
end
'@ | Set-Content -Encoding utf8 fastlane\Fastfile
